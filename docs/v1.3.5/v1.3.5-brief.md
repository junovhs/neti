# SlopChop v1.3.5: Agentic Interfaces & The Trust Engine

**Status:** Active / Draft
**Priority:** High
**Theme:** "Making SlopChop machine-readable."

## 1. Context
SlopChop is currently optimized for *human* usage (colors, spinners, interactive TUI). To function as the "Gatekeeper" for other tools (like Roadmap or autonomous Agents), it needs robust machine interfaces.

Additionally, we are introducing the "Trust Engine" capabilities to support Mutation Testing validation.

## 2. Features

### Feature A: JSON Output (`--json`)
**Problem:** Roadmap needs to know if `slopchop check` passed or failed, and *why*, without parsing ANSI color codes.
**Solution:** Add structured JSON output to core commands.

*   **Commands:** `slopchop check --json`, `slopchop scan --json`
*   **Schema (ScanReport):**
    ```json
    {
      "files": [
        { "path": "src/main.rs", "violations": [...] }
      ],
      "total_violations": 0,
      "scan_passed": true
    }
    ```
*   **Implementation:**
    *   Update `src/cli/args.rs` to add flags.
    *   Update `src/reporting.rs` to impl `print_json`.
    *   Update `src/types.rs` to derive `Serialize`.

### Feature B: The Sabotage Command (`slopchop sabotage`)
**Problem:** We need to prove tests are valid by intentionally breaking code.
**Solution:** A command that mutates source code in the **Stage** (never Workspace) to introduce logical faults.

*   **Command:** `slopchop sabotage <file>`
*   **Behavior:**
    1.  Parse file via Tree-sitter.
    2.  Identify a mutable node (Binary Op `==` -> `!=`, Boolean `true` -> `false`).
    3.  Apply mutation to the **Staged Worktree**.
    4.  Exit 0 (Success) if mutation applied, Exit 1 if no mutable logic found.
*   **Safety:** Must ONLY operate on `.slopchop/stage/worktree`.

### Feature C: Holographic Spec (`pack --spec`)
**Problem:** Documentation rot. We want "Code as Truth."
**Solution:** Extract `//!` and `///` comments into a clean Markdown document.

*   **Command:** `slopchop pack --spec`
*   **Behavior:**
    *   Iterate source files.
    *   Extract doc comments.
    *   Format as Markdown headers (e.g., `# src/lib.rs`).
    *   Output to stdout (or file via redirection).

## 3. Implementation Plan

1.  **JSON Plumbing:** Add `serde`, `serde_json` to `Cargo.toml` (if missing). derive `Serialize` on `ScanReport`, `Violation`, `FileReport`.
2.  **CLI Updates:** Add flags to `args.rs` and update `handlers.rs`.
3.  **Sabotage Engine:** Create `src/analysis/sabotage.rs`.
    *   Use tree-sitter to find ranges.
    *   Perform string replacement.
    *   Write to stage.
4.  **Spec Generator:** Update `src/pack/formats.rs` to handle doc extraction.

## 4. Success Criteria
*   `slopchop check --json | jq .total_violations` works.
*   `slopchop sabotage src/main.rs` modifies the staged file but leaves real file alone.
*   `slopchop pack --spec` produces a readable architecture doc.