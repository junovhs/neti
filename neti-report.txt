========================================
NETI SCAN REPORT
========================================

SCAN SUMMARY: 195 files | 219348 tokens | 19 violations

ALL VIOLATING FILES:
    3 violations | src\analysis\patterns\idiomatic_i02.rs
    3 violations | src\analysis\patterns\semantic.rs
    3 violations | src\analysis\structural.rs
    2 violations | src\analysis\extract.rs
    1 violations | src\analysis\ast.rs
    1 violations | src\analysis\checks\naming.rs
    1 violations | src\analysis\extract_impl.rs
    1 violations | src\analysis\patterns\logic_helpers.rs
    1 violations | src\analysis\patterns\logic_proof_helpers.rs
    1 violations | src\analysis\patterns\performance.rs
    1 violations | src\cli\handlers\scan_report.rs
    1 violations | src\lang.rs

warn: [1 of 8] Nested loop (O(n²)) detected
  --> src\analysis\ast.rs:80
   |
    79 |             for m in matches {
    80 |                 for cap in m.captures {
   |                 ^^^^^^^^^^^^^^^^^^^^^^^
    81 |                     let score = Self::process_function_node(cap.node, &ctx, &mut violations);
   = P04: Review recommended — inner loop may be bounded to a small constant
   |
   = ANALYSIS:
   |   Quadratic complexity — scales poorly with input size.
   |
   = WHY: Nested loops produce O(n²) complexity, which scales poorly with input size.
   |
   = FIX: Replace the inner loop with a lookup structure (HashMap/HashSet) for O(n) total, or confirm the inner loop is bounded to a small constant.
   |
   = SUPPRESS: // neti:allow(P04) on the line, or P04 = "warn" in neti.toml [rules]

error: [1 of 8] String conversion inside loop
  --> src\analysis\checks\naming.rs:32
   |
    31 |                 let details = ViolationDetails {
    32 |                     function_name: Some(name.to_string()),
   |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    33 |                     analysis: vec![format!("Name has {word_count} words")],
   = P02: Fix required
   |
   = ANALYSIS:
   |   `name.to_string()` allocates a new String on every iteration.
   |
   = WHY: String conversion inside a loop allocates a new String on every iteration.
   |
   = FIX: Hoist the conversion before the loop, or operate on borrowed string slices (&str).
   |
   = SUPPRESS: // neti:allow(P02) on the line, or P02 = "warn" in neti.toml [rules]

warn: [2 of 8] Nested loop (O(n²)) detected
  --> src\analysis\extract.rs:40
   = P04: Quadratic complexity — scales poorly with input size. — see first P04 above

error: [2 of 8] String conversion inside loop
  --> src\analysis\extract.rs:155
   = P02: `name.to_string()` allocates a new String on every iteration. — see first P02 above

error: [3 of 8] String conversion inside loop
  --> src\analysis\extract_impl.rs:30
   = P02: `cap
                .node
                .utf8_text(source.as_bytes())
                .unwrap_or("").to_string()` allocates a new String on every iteration. — see first P02 above

warn: [3 of 8] Nested loop (O(n²)) detected
  --> src\analysis\patterns\idiomatic_i02.rs:29
   = P04: Quadratic complexity — scales poorly with input size. — see first P04 above

error: [4 of 8] String conversion inside loop
  --> src\analysis\patterns\idiomatic_i02.rs:88
   = P02: `body.to_string()` allocates a new String on every iteration. — see first P02 above

warn: Detected `.clone()` inside a loop
  --> src\analysis\patterns\idiomatic_i02.rs:139
   |
   138 |         let unique_count = {
   139 |             let mut sorted = names_in_slot.clone();
   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   140 |             sorted.sort();
   = P01: Review recommended — receiver `names_in_slot` matches a heuristic keyword but type is unverified
   |
   = ANALYSIS:
   |   Receiver `names_in_slot` appears to be a heap-owning type.
   |   Clone inside a loop allocates on every iteration.
   |
   = WHY: Cloning/copying inside a loop allocates on every iteration, scaling linearly with iteration count.
   |
   = FIX: Hoist the allocation before the loop, use a reference or borrow, or confirm the copy is cheap (primitives, small structs, reference-counted pointers).
   |
   = SUPPRESS: // neti:allow(P01) on the line, or P01 = "warn" in neti.toml [rules]

warn: Linear search inside loop — O(n·m) complexity
  --> src\analysis\patterns\logic_helpers.rs:173
   |
   172 | 
   173 |         if let Some(colon_pos) = clean.find(':') {
   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   174 |             let param_name = clean[..colon_pos].trim();
   = P06: Review recommended — linear scan may be intentional algorithm or bounded collection
   |
   = ANALYSIS:
   |   Each outer iteration performs a full inner scan.
   |
   = WHY: Linear search (.find/.position/.index) inside a loop produces O(n·m) complexity.
   |
   = FIX: Pre-build a lookup structure (HashSet/HashMap/dict/Set) for O(1) access, or confirm the inner collection is bounded to a small constant size.
   |
   = SUPPRESS: // neti:allow(P06) on the line, or P06 = "warn" in neti.toml [rules]

warn: [4 of 8] Nested loop (O(n²)) detected
  --> src\analysis\patterns\logic_proof_helpers.rs:25
   = P04: Quadratic complexity — scales poorly with input size. — see first P04 above

error: [5 of 8] String conversion inside loop
  --> src\analysis\patterns\performance.rs:83
   = P02: `s.split([',', '(']).next().unwrap_or(s).trim().to_string()` allocates a new String on every iteration. — see first P02 above

error: [6 of 8] String conversion inside loop
  --> src\analysis\patterns\semantic.rs:47
   = P02: `name.to_string()` allocates a new String on every iteration. — see first P02 above

error: [7 of 8] String conversion inside loop
  --> src\analysis\patterns\semantic.rs:85
   = P02: `name.to_string()` allocates a new String on every iteration. — see first P02 above

error: [8 of 8] String conversion inside loop
  --> src\analysis\patterns\semantic.rs:123
   = P02: `name.to_string()` allocates a new String on every iteration. — see first P02 above

warn: [5 of 8] Nested loop (O(n²)) detected
  --> src\analysis\structural.rs:29
   = P04: Quadratic complexity — scales poorly with input size. — see first P04 above

warn: [6 of 8] Nested loop (O(n²)) detected
  --> src\analysis\structural.rs:74
   = P04: Quadratic complexity — scales poorly with input size. — see first P04 above

warn: [7 of 8] Nested loop (O(n²)) detected
  --> src\analysis\structural.rs:129
   = P04: Quadratic complexity — scales poorly with input size. — see first P04 above

warn: [8 of 8] Nested loop (O(n²)) detected
  --> src\cli\handlers\scan_report.rs:97
   = P04: Quadratic complexity — scales poorly with input size. — see first P04 above

error: Potential N+1 query: `query` in loop
  --> src\lang.rs:114
   |
   113 |         ] {
   114 |             let q = Lang::Swift.query(kind); // neti:allow(P03)
   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   115 |             let result = tree_sitter::Query::new(&lang, q);
   = P03: Fix required
   |
   = ANALYSIS:
   |   DB call inside loop causes N+1 queries.
   |   Loop variable `kind` used in call.
   |
   = SUPPRESS: // neti:allow(P03) on the line, or P03 = "warn" in neti.toml [rules]

X Neti found 9 errors, 10 warnings (1.555s).


========================================
NETI COMMANDS REPORT
========================================

$ cargo clippy --all-targets --no-deps -- -D warnings
> FAIL (2413ms)
Checking neti v1.6.6 (C:\Users\SpencerNunamakerTrav\neti)
error[E0308]: mismatched types
   --> src\analysis\checks\syntax_test.rs:10:25
    |
 10 |     parser.set_language(Lang::Rust.grammar()).unwrap();
    |            ------------ ^^^^^^^^^^^^^^^^^^^^ expected `&Language`, found `Language`
    |            |
    |            arguments to this method are incorrect
    |
note: method defined here
   --> C:\Users\SpencerNunamakerTrav\.cargo\registry\src\index.crates.io-1949cf8c6b5b557f\tree-sitter-0.23.2\binding_rust\lib.rs:474:12
    |
474 |     pub fn set_language(&mut self, language: &Language) -> Result<(), LanguageError> {
    |            ^^^^^^^^^^^^
help: consider borrowing here
    |
 10 |     parser.set_language(&Lang::Rust.grammar()).unwrap();
    |                         +

error[E0308]: mismatched types
   --> src\analysis\patterns\mod.rs:57:25
    |
 57 |     parser.set_language(lang.grammar()).ok()?;
    |            ------------ ^^^^^^^^^^^^^^ expected `&Language`, found `Language`
    |            |
    |            arguments to this method are incorrect
    |
note: method defined here
   --> C:\Users\SpencerNunamakerTrav\.cargo\registry\src\index.crates.io-1949cf8c6b5b557f\tree-sitter-0.23.2\binding_rust\lib.rs:474:12
    |
474 |     pub fn set_language(&mut self, language: &Language) -> Result<(), LanguageError> {
    |            ^^^^^^^^^^^^
help: consider borrowing here
    |
 57 |     parser.set_language(&lang.grammar()).ok()?;
    |                         +

error[E0308]: mismatched types
   --> src\mutate\discovery.rs:28:23
    |
 28 |         .set_language(lang.grammar())
    |          ------------ ^^^^^^^^^^^^^^ expected `&Language`, found `Language`
    |          |
    |          arguments to this method are incorrect
    |
note: method defined here
   --> C:\Users\SpencerNunamakerTrav\.cargo\registry\src\index.crates.io-1949cf8c6b5b557f\tree-sitter-0.23.2\binding_rust\lib.rs:474:12
    |
474 |     pub fn set_language(&mut self, language: &Language) -> Result<(), LanguageError> {
    |            ^^^^^^^^^^^^
help: consider borrowing here
    |
 28 |         .set_language(&lang.grammar())
    |                       +

error[E0308]: mismatched types
   --> src\mutate\discovery.rs:108:29
    |
108 |         parser.set_language(Lang::Rust.grammar()).ok();
    |                ------------ ^^^^^^^^^^^^^^^^^^^^ expected `&Language`, found `Language`
    |                |
    |                arguments to this method are incorrect
    |
note: method defined here
   --> C:\Users\SpencerNunamakerTrav\.cargo\registry\src\index.crates.io-1949cf8c6b5b557f\tree-sitter-0.23.2\binding_rust\lib.rs:474:12
    |
474 |     pub fn set_language(&mut self, language: &Language) -> Result<(), LanguageError> {
    |            ^^^^^^^^^^^^
help: consider borrowing here
    |
108 |         parser.set_language(&Lang::Rust.grammar()).ok();
    |                             +

For more information about this error, try `rustc --explain E0308`.
error: could not compile `neti` (lib) due to 2 previous errors
warning: build failed, waiting for other jobs to finish...
error: could not compile `neti` (lib test) due to 4 previous errors
[exit code: 101]

$ cargo test
> FAIL (1976ms)
Compiling neti v1.6.6 (C:\Users\SpencerNunamakerTrav\neti)
error[E0308]: mismatched types
   --> src\analysis\checks\syntax_test.rs:10:25
    |
 10 |     parser.set_language(Lang::Rust.grammar()).unwrap();
    |            ------------ ^^^^^^^^^^^^^^^^^^^^ expected `&Language`, found `Language`
    |            |
    |            arguments to this method are incorrect
    |
note: method defined here
   --> C:\Users\SpencerNunamakerTrav\.cargo\registry\src\index.crates.io-1949cf8c6b5b557f\tree-sitter-0.23.2\binding_rust\lib.rs:474:12
    |
474 |     pub fn set_language(&mut self, language: &Language) -> Result<(), LanguageError> {
    |            ^^^^^^^^^^^^
help: consider borrowing here
    |
 10 |     parser.set_language(&Lang::Rust.grammar()).unwrap();
    |                         +

error[E0308]: mismatched types
   --> src\analysis\patterns\mod.rs:57:25
    |
 57 |     parser.set_language(lang.grammar()).ok()?;
    |            ------------ ^^^^^^^^^^^^^^ expected `&Language`, found `Language`
    |            |
    |            arguments to this method are incorrect
    |
note: method defined here
   --> C:\Users\SpencerNunamakerTrav\.cargo\registry\src\index.crates.io-1949cf8c6b5b557f\tree-sitter-0.23.2\binding_rust\lib.rs:474:12
    |
474 |     pub fn set_language(&mut self, language: &Language) -> Result<(), LanguageError> {
    |            ^^^^^^^^^^^^
help: consider borrowing here
    |
 57 |     parser.set_language(&lang.grammar()).ok()?;
    |                         +

error[E0308]: mismatched types
   --> src\mutate\discovery.rs:28:23
    |
 28 |         .set_language(lang.grammar())
    |          ------------ ^^^^^^^^^^^^^^ expected `&Language`, found `Language`
    |          |
    |          arguments to this method are incorrect
    |
note: method defined here
   --> C:\Users\SpencerNunamakerTrav\.cargo\registry\src\index.crates.io-1949cf8c6b5b557f\tree-sitter-0.23.2\binding_rust\lib.rs:474:12
    |
474 |     pub fn set_language(&mut self, language: &Language) -> Result<(), LanguageError> {
    |            ^^^^^^^^^^^^
help: consider borrowing here
    |
 28 |         .set_language(&lang.grammar())
    |                       +

error[E0308]: mismatched types
   --> src\mutate\discovery.rs:108:29
    |
108 |         parser.set_language(Lang::Rust.grammar()).ok();
    |                ------------ ^^^^^^^^^^^^^^^^^^^^ expected `&Language`, found `Language`
    |                |
    |                arguments to this method are incorrect
    |
note: method defined here
   --> C:\Users\SpencerNunamakerTrav\.cargo\registry\src\index.crates.io-1949cf8c6b5b557f\tree-sitter-0.23.2\binding_rust\lib.rs:474:12
    |
474 |     pub fn set_language(&mut self, language: &Language) -> Result<(), LanguageError> {
    |            ^^^^^^^^^^^^
help: consider borrowing here
    |
108 |         parser.set_language(&Lang::Rust.grammar()).ok();
    |                             +

For more information about this error, try `rustc --explain E0308`.
error: could not compile `neti` (lib) due to 2 previous errors
warning: build failed, waiting for other jobs to finish...
error: could not compile `neti` (lib test) due to 4 previous errors
[exit code: 101]

