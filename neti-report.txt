========================================
NETI SCAN REPORT
========================================

SCAN SUMMARY: 170 files | 216163 tokens | 51 violations

ALL VIOLATING FILES:
    9 violations | src\analysis\patterns\idiomatic.rs
    4 violations | src\analysis\patterns\logic_helpers.rs
    4 violations | src\analysis\patterns\logic_proof.rs
    3 violations | src\analysis\patterns\semantic.rs
    3 violations | src\analysis\structural.rs
    3 violations | src\graph\locality\report.rs
    3 violations | src\reporting.rs
    2 violations | src\analysis\extract.rs
    2 violations | src\analysis\patterns\performance.rs
    2 violations | src\file_class.rs
    2 violations | src\graph\imports.rs
    2 violations | src\graph\rank\builder.rs
    2 violations | src\skeleton.rs
    1 violations | src\analysis\ast.rs
    1 violations | src\analysis\checks\naming.rs
    1 violations | src\analysis\checks\syntax.rs
    1 violations | src\analysis\extract_impl.rs
    1 violations | src\analysis\patterns\concurrency_lock.rs
    1 violations | src\analysis\patterns\logic.rs
    1 violations | src\analysis\patterns\security.rs
    1 violations | src\cli\handlers\scan_report.rs
    1 violations | src\graph\locality\layers.rs
    1 violations | src\graph\locality\tests.rs

warn: [1 of 17] Nested loop (O(n²)) detected
  --> src\analysis\ast.rs:76
   |
    75 |             for m in matches {
    76 |                 for cap in m.captures {
   |                 ^^^^^^^^^^^^^^^^^^^^^^^
    77 |                     let score = Self::process_function_node(cap.node, &ctx, &mut violations);
   = P04: Review recommended — inner loop may be bounded to a small constant
   |
   = ANALYSIS:
   |   Quadratic complexity — scales poorly with input size.
   |
   = WHY: Nested loops produce O(n²) complexity, which scales poorly with input size.
   |
   = FIX: Replace the inner loop with a lookup structure (HashMap/HashSet) for O(n) total, or confirm the inner loop is bounded to a small constant.
   |
   = SUPPRESS: // neti:allow(P04) on the line, or P04 = "warn" in neti.toml [rules]

error: [1 of 12] String conversion inside loop
  --> src\analysis\checks\naming.rs:32
   |
    31 |                 let details = ViolationDetails {
    32 |                     function_name: Some(name.to_string()),
   |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    33 |                     analysis: vec![format!("Name has {word_count} words")],
   = P02: Fix required
   |
   = ANALYSIS:
   |   `name.to_string()` allocates a new String on every iteration.
   |
   = WHY: String conversion inside a loop allocates a new String on every iteration.
   |
   = FIX: Hoist the conversion before the loop, or operate on borrowed string slices (&str).
   |
   = SUPPRESS: // neti:allow(P02) on the line, or P02 = "warn" in neti.toml [rules]

error: [1 of 10] File size is 2548 tokens (Limit: 2000)
  --> src\analysis\checks\syntax.rs:1
   |
     1 | //! AST-level syntax error and malformed node detection.
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
     2 | //!
   = LAW OF ATOMICITY: Fix required
   |
   = WHY: Files beyond the token limit are too large for a single unit of work, increasing cognitive load and merge conflict risk.
   |
   = FIX: Split the file into smaller, focused modules. Extract related functions into their own files.
   |
   = SUPPRESS: // neti:allow(LAW OF ATOMICITY) on the line, or LAW OF ATOMICITY = "warn" in neti.toml [rules]

warn: [2 of 17] Nested loop (O(n²)) detected
  --> src\analysis\extract.rs:39
   = P04: Quadratic complexity — scales poorly with input size. — see first P04 above

error: [2 of 12] String conversion inside loop
  --> src\analysis\extract.rs:154
   = P02: `name.to_string()` allocates a new String on every iteration. — see first P02 above

error: [3 of 12] String conversion inside loop
  --> src\analysis\extract_impl.rs:29
   = P02: `cap
                .node
                .utf8_text(source.as_bytes())
                .unwrap_or("").to_string()` allocates a new String on every iteration. — see first P02 above

error: [2 of 10] File size is 2263 tokens (Limit: 2000)
  --> src\analysis\patterns\concurrency_lock.rs:1
   = LAW OF ATOMICITY: see first LAW OF ATOMICITY above

error: [3 of 10] File size is 3128 tokens (Limit: 2000)
  --> src\analysis\patterns\idiomatic.rs:1
   = LAW OF ATOMICITY: see first LAW OF ATOMICITY above

warn: [1 of 3] Linear search inside loop — O(n·m) complexity
  --> src\analysis\patterns\idiomatic.rs:105
   |
   104 |         let Some(match_node) =
   105 |             idx_match.and_then(|i| m.captures.iter().find(|c| c.index == i).map(|c| c.node))
   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   106 |         else {
   = P06: Review recommended — linear scan may be intentional algorithm or bounded collection
   |
   = ANALYSIS:
   |   Each outer iteration performs a full inner scan.
   |
   = WHY: Linear search (.find/.position/.index) inside a loop produces O(n·m) complexity.
   |
   = FIX: Pre-build a lookup structure (HashSet/HashMap/dict/Set) for O(1) access, or confirm the inner collection is bounded to a small constant size.
   |
   = SUPPRESS: // neti:allow(P06) on the line, or P06 = "warn" in neti.toml [rules]

warn: [2 of 3] Linear search inside loop — O(n·m) complexity
  --> src\analysis\patterns\idiomatic.rs:110
   = P06: Each outer iteration performs a full inner scan. — see first P06 above

error: [4 of 12] String conversion inside loop
  --> src\analysis\patterns\idiomatic.rs:132
   = P02: `pattern_node
            .and_then(|n| n.utf8_text(source.as_bytes()).ok())
            .unwrap_or("").to_string()` allocates a new String on every iteration. — see first P02 above

error: [5 of 12] String conversion inside loop
  --> src\analysis\patterns\idiomatic.rs:138
   = P02: `body_text.trim().to_string()` allocates a new String on every iteration. — see first P02 above

error: [1 of 3] Detected `.clone()` inside a loop
  --> src\analysis\patterns\idiomatic.rs:152
   |
   151 | 
   152 |         let patterns = arm_patterns.get(body).unwrap_or(&Vec::new()).clone();
   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   153 | 
   = P01: Fix required
   |
   = ANALYSIS:
   |   Receiver `arm_patterns.get(body).unwrap_or(&Vec::new())` appears to be a heap-owning type.
   |   Clone inside a loop allocates on every iteration.
   |
   = WHY: Cloning/copying inside a loop allocates on every iteration, scaling linearly with iteration count.
   |
   = FIX: Hoist the allocation before the loop, use a reference or borrow, or confirm the copy is cheap (primitives, small structs, reference-counted pointers).
   |
   = SUPPRESS: // neti:allow(P01) on the line, or P01 = "warn" in neti.toml [rules]

warn: [2 of 3] Detected `.clone()` inside a loop
  --> src\analysis\patterns\idiomatic.rs:161
   = P01: Receiver `body` appears to be a heap-owning type. — see first P01 above

warn: [3 of 3] Detected `.clone()` inside a loop
  --> src\analysis\patterns\idiomatic.rs:212
   = P01: Receiver `names_in_slot` appears to be a heap-owning type. — see first P01 above

error: [6 of 12] String conversion inside loop
  --> src\analysis\patterns\idiomatic.rs:300
   = P02: `trimmed.to_string()` allocates a new String on every iteration. — see first P02 above

error: [4 of 10] File size is 3906 tokens (Limit: 2000)
  --> src\analysis\patterns\logic.rs:1
   = LAW OF ATOMICITY: see first LAW OF ATOMICITY above

error: [5 of 10] File size is 2146 tokens (Limit: 2000)
  --> src\analysis\patterns\logic_helpers.rs:1
   = LAW OF ATOMICITY: see first LAW OF ATOMICITY above

warn: [3 of 17] Nested loop (O(n²)) detected
  --> src\analysis\patterns\logic_helpers.rs:84
   = P04: Quadratic complexity — scales poorly with input size. — see first P04 above

warn: [3 of 3] Linear search inside loop — O(n·m) complexity
  --> src\analysis\patterns\logic_helpers.rs:162
   = P06: Each outer iteration performs a full inner scan. — see first P06 above

error: [1 of 2] Function 'can_find_local_declaration' has cognitive complexity 26 (Max: 25)
  --> src\analysis\patterns\logic_helpers.rs:73
   |
    72 | /// or whether `var_name` is a function/closure parameter.
    73 | pub fn can_find_local_declaration(source: &str, node: Node, var_name: &str) -> bool {
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    74 |     if var_name.contains('.') {
   = LAW OF COMPLEXITY: Fix required
   |
   = ANALYSIS:
   |   Cognitive score: 26
   |
   = SUPPRESS: // neti:allow(LAW OF COMPLEXITY) on the line, or LAW OF COMPLEXITY = "warn" in neti.toml [rules]

error: [6 of 10] File size is 3164 tokens (Limit: 2000)
  --> src\analysis\patterns\logic_proof.rs:1
   = LAW OF ATOMICITY: see first LAW OF ATOMICITY above

warn: [4 of 17] Nested loop (O(n²)) detected
  --> src\analysis\patterns\logic_proof.rs:66
   = P04: Quadratic complexity — scales poorly with input size. — see first P04 above

warn: [5 of 17] Nested loop (O(n²)) detected
  --> src\analysis\patterns\logic_proof.rs:175
   = P04: Quadratic complexity — scales poorly with input size. — see first P04 above

error: [2 of 2] Function 'find_local_array_size' has cognitive complexity 26 (Max: 25)
  --> src\analysis\patterns\logic_proof.rs:55
   = LAW OF COMPLEXITY: Cognitive score: 26 — see first LAW OF COMPLEXITY above

error: [7 of 10] File size is 5216 tokens (Limit: 2000)
  --> src\analysis\patterns\performance.rs:1
   = LAW OF ATOMICITY: see first LAW OF ATOMICITY above

error: [7 of 12] String conversion inside loop
  --> src\analysis\patterns\performance.rs:71
   = P02: `s.split([',', '(']).next().unwrap_or(s).trim().to_string()` allocates a new String on every iteration. — see first P02 above

error: [8 of 10] File size is 3272 tokens (Limit: 2000)
  --> src\analysis\patterns\security.rs:1
   = LAW OF ATOMICITY: see first LAW OF ATOMICITY above

error: [8 of 12] String conversion inside loop
  --> src\analysis\patterns\semantic.rs:47
   = P02: `name.to_string()` allocates a new String on every iteration. — see first P02 above

error: [9 of 12] String conversion inside loop
  --> src\analysis\patterns\semantic.rs:85
   = P02: `name.to_string()` allocates a new String on every iteration. — see first P02 above

error: [10 of 12] String conversion inside loop
  --> src\analysis\patterns\semantic.rs:123
   = P02: `name.to_string()` allocates a new String on every iteration. — see first P02 above

warn: [6 of 17] Nested loop (O(n²)) detected
  --> src\analysis\structural.rs:29
   = P04: Quadratic complexity — scales poorly with input size. — see first P04 above

warn: [7 of 17] Nested loop (O(n²)) detected
  --> src\analysis\structural.rs:74
   = P04: Quadratic complexity — scales poorly with input size. — see first P04 above

warn: [8 of 17] Nested loop (O(n²)) detected
  --> src\analysis\structural.rs:129
   = P04: Quadratic complexity — scales poorly with input size. — see first P04 above

warn: [9 of 17] Nested loop (O(n²)) detected
  --> src\cli\handlers\scan_report.rs:97
   = P04: Quadratic complexity — scales poorly with input size. — see first P04 above

error: [1 of 4] Duplicate match arm bodies
  --> src\file_class.rs:80
   |
    79 | fn classify_by_ext(ext: &str) -> FileKind {
    80 |     match ext {
   |     ^^^^^^^^^^^
    81 |         // Source code — governed by all structural laws
   = I02: Fix required
   |
   = ANALYSIS:
   |   Duplicate: `FileKind::Config`
   |
   = WHY: Duplicate match arm bodies indicate arms that could be combined with the | pattern.
   |
   = FIX: Combine arms: `A | B => shared_body`. Only valid when bindings have compatible types.
   |
   = SUPPRESS: // neti:allow(I02) on the line, or I02 = "warn" in neti.toml [rules]

error: [2 of 4] Duplicate match arm bodies
  --> src\file_class.rs:80
   = I02: Duplicate: `FileKind::Other` — see first I02 above

warn: [10 of 17] Nested loop (O(n²)) detected
  --> src\graph\imports.rs:45
   = P04: Quadratic complexity — scales poorly with input size. — see first P04 above

warn: [11 of 17] Nested loop (O(n²)) detected
  --> src\graph\imports.rs:100
   = P04: Quadratic complexity — scales poorly with input size. — see first P04 above

warn: [12 of 17] Nested loop (O(n²)) detected
  --> src\graph\locality\layers.rs:32
   = P04: Quadratic complexity — scales poorly with input size. — see first P04 above

warn: [13 of 17] Nested loop (O(n²)) detected
  --> src\graph\locality\report.rs:81
   = P04: Quadratic complexity — scales poorly with input size. — see first P04 above

warn: [14 of 17] Nested loop (O(n²)) detected
  --> src\graph\locality\report.rs:105
   = P04: Quadratic complexity — scales poorly with input size. — see first P04 above

error: [11 of 12] String conversion inside loop
  --> src\graph\locality\report.rs:178
   = P02: `name.to_string()` allocates a new String on every iteration. — see first P02 above

error: [9 of 10] File size is 2482 tokens (Limit: 2000)
  --> src\graph\locality\tests.rs:1
   = LAW OF ATOMICITY: see first LAW OF ATOMICITY above

error: [12 of 12] String conversion inside loop
  --> src\graph\rank\builder.rs:100
   = P02: `ref_name
            .split("::")
            .last()
            .unwrap_or(&ref_name).to_string()` allocates a new String on every iteration. — see first P02 above

warn: [15 of 17] Nested loop (O(n²)) detected
  --> src\graph\rank\builder.rs:150
   = P04: Quadratic complexity — scales poorly with input size. — see first P04 above

error: [10 of 10] File size is 4783 tokens (Limit: 2000)
  --> src\reporting.rs:1
   = LAW OF ATOMICITY: see first LAW OF ATOMICITY above

error: [3 of 4] Duplicate match arm bodies
  --> src\reporting.rs:168
   = I02: Duplicate: `v.confidence.label().to_string...` — see first I02 above

error: [4 of 4] Duplicate match arm bodies
  --> src\reporting.rs:437
   = I02: Duplicate: `v.confidence.label().to_string...` — see first I02 above

warn: [16 of 17] Nested loop (O(n²)) detected
  --> src\skeleton.rs:47
   = P04: Quadratic complexity — scales poorly with input size. — see first P04 above

warn: [17 of 17] Nested loop (O(n²)) detected
  --> src\skeleton.rs:207
   = P04: Quadratic complexity — scales poorly with input size. — see first P04 above

X Neti found 29 errors, 22 warnings (1.707s).


========================================
NETI COMMANDS REPORT
========================================

$ cargo clippy --all-targets --no-deps -- -D warnings
> PASS (16344ms)

$ cargo test
> PASS (21973ms)

